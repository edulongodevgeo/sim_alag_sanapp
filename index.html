<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador de Risco de Alagamento - Florian√≥polis</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header>
    <div class="title">
      <h1>Simulador de Risco de Alagamento</h1>
      <p class="subtitle">Mock (sensores + hist√≥rico de chuva) ‚Äî Florian√≥polis/SC</p>
    </div>
    <div class="controls">
      <button id="infoBtn" class="icon-btn-header" title="Sobre o Sistema">‚ÑπÔ∏è</button>
      <button id="zoomAltBtn" class="icon-btn-header" title="Centralizar Mapa">üåç</button>

      <div class="separator"></div>

      <div class="sim-group">
        <input type="number" id="simInput" placeholder="Simular mm" style="width:100px" />
        <button id="simBtn" class="action-btn">Simular</button>
        <button id="resetSimBtn" class="action-btn outline hidden">Reset</button>
      </div>

      <div class="separator"></div>

      <label for="timeSelect">Previs√£o do tempo:</label>
      <select id="timeSelect"></select>
      <label class="chk"><input type="checkbox" id="onlyHigh" /> mostrar apenas
        <strong>alta</strong>/<strong>cr√≠tica</strong></label>
      <input id="search" type="search" placeholder="Filtrar por sensor" />
    </div>
  </header>

  <main>
    <section class="panel map">
      <div id="map"></div>
      <div class="legend">
        <div class="legend-row"><span class="dot pouca"></span> pouca</div>
        <div class="legend-row"><span class="dot media"></span> m√©dia</div>
        <div class="legend-row"><span class="dot alta"></span> alta</div>
        <div class="legend-row"><span class="dot critica"></span> cr√≠tica</div>
      </div>
    </section>

    <section class="panel table">
      <div class="table-head">
        <h2>Resultados por sensor</h2>
        <div class="meta" id="meta"></div>
      </div>
      <div class="table-wrap">
        <table id="results">
          <thead>
            <tr>
              <th data-sort="sensor_id">Sensor</th>
              <th data-sort="name">Nome</th>
              <th class="num" data-sort="score">Score (0‚Äì100)</th>
              <th data-sort="categoria">Categoria</th>
              <th class="num" colspan="3">Chuva Prevista (Dia)</th>
              <th style="width:90px; text-align:center">A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <p class="note">
        Regras de neg√≥cio: o <em>score</em> √© calculado com base na chuva total do dia e sensibilidade do local,
        classificado em: pouca, m√©dia, alta, cr√≠tica.
      </p>
    </section>
  </main>

  <div id="historyModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="historyTitle">Hist√≥rico</h2>
        <button class="close-btn" onclick="closeHistory()">&times;</button>
      </div>
      <div class="modal-body">
        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th class="num">Chuva (mm)</th>
              <th style="text-align:center">Extravasou?</th>
              <th style="text-align:center" title="Maior mar√© do dia">üåä Mar√©</th>
              <th style="text-align:center" title="Fase da lua">üåô Lua</th>
            </tr>
          </thead>
          <tbody id="historyTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="fuzzyModal" class="modal hidden">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2>An√°lise de Risco</h2>
        <button class="close-btn" onclick="closeFuzzy()">&times;</button>
      </div>
      <div class="modal-body" style="padding: 20px;">

        <div style="margin-bottom: 20px; text-align: center;">
          <h3 id="fuzzySensorTitle" style="margin:0 0 5px 0">Sensor S001</h3>
          <div id="fuzzySubtitle" style="color:var(--text-secondary); font-size:0.9rem">Chuva: 10mm | Vuln: 0.27</div>
        </div>

        <!-- Gauge Container -->
        <div class="fuzzy-gauge-container">
          <div class="fuzzy-scale">
            <div class="scale-section" style="background:#39d98a; width:50%">Pouca</div>
            <div class="scale-section" style="background:#f6c343; width:25%">M√©dia</div>
            <div class="scale-section" style="background:#ff8a4c; width:15%">Alta</div>
            <div class="scale-section" style="background:#ff4d6d; width:10%">Crit</div>
          </div>
          <div id="fuzzyNeedle" class="fuzzy-needle"></div>
          <div id="fuzzyScoreDisplay" class="fuzzy-score-val">Score: 0</div>
        </div>

        <div class="didactic-box">
          <h4>üß† Entenda o C√°lculo:</h4>
          <p id="fuzzyExplanation">
            O risco √© calculado multiplicando a <b>Chuva do Dia</b> pelo fator de <b>Vulnerabilidade</b> do local.
            <br />
            Sua pontua√ß√£o caiu na faixa <b>Verde</b>, indicando probabilidade <br /> m√≠nima de alagamento.
          </p>
        </div>

      </div>
    </div>
  </div>

  <div id="infoModal" class="modal hidden">
    <div class="modal-content" style="max-width: 650px;">
      <div class="modal-header">
        <h2>Como funciona o Sistema?</h2>
        <button class="close-btn" onclick="closeInfo()">&times;</button>
      </div>
      <div class="modal-body" style="padding: 20px; line-height: 1.6;">

        <div style="margin-bottom: 20px;">
          <h3 style="color:var(--accent); margin-bottom:10px;">üõ°Ô∏è Vulnerabilidade (Conceito Vivo)</h3>
          <p>A vulnerabilidade <b>N√ÉO √© fixa</b>. Ela √© flutuante e muda dia a dia.
            <br />Ela √© a rela√ß√£o entre a chuva que vai cair e o hist√≥rico do local.
          <ul style="margin-top:5px; padding-left:20px; color:var(--text-secondary)">
            <li>Se vai chover MAIS do que o sensor costuma aguentar: <b>Vulnerabilidade ALTA</b>.</li>
            <li>Se vai chover MENOS do que o limite hist√≥rico: <b>Vulnerabilidade BAIXA</b>.</li>
          </ul>
          <i>O local pode ser seguro hoje (Vuln Baixa) e perigoso amanh√£ (Vuln Alta).</i>
          </p>
        </div>

        <div style="margin-bottom: 20px;">
          <h3 style="color:var(--accent); margin-bottom:10px;">üß† Intelig√™ncia (Score de Risco)</h3>
          <p>O sistema "aprendeu" com o hist√≥rico qual a chuva cr√≠tica para cada sensor.
            <br />O Score (0-100) mostra qu√£o perto a previs√£o de hoje est√° desse limite.
          </p>
          <div
            style="background:rgba(255,255,255,0.05); padding:10px; border-radius:6px; margin-top:5px; text-align:center; font-family:monospace;">
            Score = (Chuva Prevista / Limiar Hist√≥rico) * 100
          </div>
        </div>

        <div>
          <h3 style="color:var(--accent); margin-bottom:10px;">üö¶ Categorias de Risco</h3>
          <table style="width:100%; border-collapse:collapse; font-size:0.9rem;">
            <tr style="border-bottom:1px solid var(--border)">
              <th style="text-align:left; padding:5px;">Risco</th>
              <th style="padding:5px;">Score</th>
              <th style="text-align:left; padding:5px;">Significado</th>
            </tr>
            <tr>
              <td style="padding:5px; color:#39d98a; font-weight:bold;">Baixo</td>
              <td style="text-align:center;">&lt; 50%</td>
              <td>Seguro. Chuva dentro do suportado.</td>
            </tr>
            <tr>
              <td style="padding:5px; color:#f6c343; font-weight:bold;">M√©dio</td>
              <td style="text-align:center;">50 - 75%</td>
              <td>Aten√ß√£o. Pr√≥ximo da metade do limite.</td>
            </tr>
            <tr>
              <td style="padding:5px; color:#ff8a4c; font-weight:bold;">Alto</td>
              <td style="text-align:center;">75 - 90%</td>
              <td>Alerta. Pr√≥ximo do limite hist√≥rico.</td>
            </tr>
            <tr>
              <td style="padding:5px; color:#ff4d6d; font-weight:bold;">Cr√≠tico</td>
              <td style="text-align:center;">&gt; 90%</td>
              <td>Perigo. Chuva igual ou maior que a de alagamentos passados.</td>
            </tr>
          </table>
        </div>

      </div>
    </div>
  </div>

  <footer>
    <span>Arquivos de entrada: <code>data/sensores.json</code>, <code>data/historyu_mm_rain.json</code>,
      <code>data/history_sensores.json</code>, <code>data/previsao_tempo.json</code></span>
  </footer>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="app.js"></script>
</body>

</html>